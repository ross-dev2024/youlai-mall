<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.youlai.system.mapper.SysPkgDetailMapper">

<!--    <resultMap id="BaseResultMap" type="com.youlai.system.model.entity.PkgDetailEntity">-->
<!--        &lt;!&ndash;@Table sys_pkg_detail&ndash;&gt;-->
<!--            <result property="id" column="id" jdbcType="INTEGER"/>-->
<!--            <result property="pkgId" column="pkg_id" jdbcType="INTEGER"/>-->
<!--            <result property="itemId" column="item_id" jdbcType="INTEGER"/>-->
<!--            <result property="itemName" column="item_name" jdbcType="VARCHAR"/>-->
<!--            <result property="itemPrice" column="item_price" jdbcType="VARCHAR"/>-->
<!--            <result property="username" column="username" jdbcType="VARCHAR"/>-->
<!--            <result property="mobile" column="mobile" jdbcType="VARCHAR"/>-->
<!--            <result property="status" column="status" jdbcType="BOOLEAN"/>-->
<!--            <result property="comment" column="comment" jdbcType="VARCHAR"/>-->
<!--            <result property="deleted" column="deleted" jdbcType="BOOLEAN"/>-->
<!--            <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>-->
<!--            <result property="updateTime" column="update_time" jdbcType="TIMESTAMP"/>-->
<!--            <result property="createBy" column="create_by" jdbcType="INTEGER"/>-->
<!--            <result property="updateBy" column="update_by" jdbcType="INTEGER"/>-->
<!--    </resultMap>-->

    <sql id="Base_Column_List">
        d.id,
        d.pkg_id,
        p.name as pkg_Name,
        d.item_id,
        d.item_name,
        d.item_price,
        d.username,
        d.mobile,
        d.status,
        d.comment,
        d.deleted,
        d.create_time,
        d.update_time,
        d.create_by,
        d.update_by
    </sql>


    <select id="selectPkgDetailPage" resultType="com.youlai.system.model.vo.PkgDetailPageVO">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sys_pkg_detail d
        LEFT JOIN sys_pkg p on d.pkg_id=p.id
        <where>
<!--            ${ew.sqlSegment}-->
             d.deleted = 0
            <if test='queryParams.keywords!=null and queryParams.keywords.trim() neq ""'>
                AND (p.name LIKE CONCAT('%',#{queryParams.keywords},'%')
                OR d.item_name LIKE CONCAT('%',#{queryParams.keywords},'%')
                OR d.comment LIKE CONCAT('%',#{queryParams.keywords},'%'))
            </if>
            <if test='queryParams.status!=null'>
                AND d.status = #{queryParams.status}
            </if>
            <if test='queryParams.pkgId!=null'>
                AND concat(',',concat(p.tree_path,',',p.id),',') like concat('%,',#{queryParams.pkgId},',%')
            </if>

        </where>
    </select>

<!--    &lt;!&ndash; 批量插入 &ndash;&gt;-->
<!--    <insert id="insertBatch" keyProperty="id" useGeneratedKeys="true">-->
<!--        insert into youlai_system.sys_pkg_detail(pkg_id, item_id, item_name, item_price, username, mobile, status, comment, deleted, create_time, update_time, create_by, update_by)-->
<!--        values-->
<!--        <foreach collection="entities" item="entity" separator=",">-->
<!--        (#{entity.pkgId}, #{entity.itemId}, #{entity.itemName}, #{entity.itemPrice}, #{entity.username}, #{entity.mobile}, #{entity.status}, #{entity.comment}, #{entity.deleted}, #{entity.createTime}, #{entity.updateTime}, #{entity.createBy}, #{entity.updateBy})-->
<!--        </foreach>-->
<!--    </insert>-->
<!--    &lt;!&ndash; 批量插入或按主键更新 &ndash;&gt;-->
<!--    <insert id="insertOrUpdateBatch" keyProperty="id" useGeneratedKeys="true">-->
<!--        insert into youlai_system.sys_pkg_detail(pkg_id, item_id, item_name, item_price, username, mobile, status, comment, deleted, create_time, update_time, create_by, update_by)-->
<!--        values-->
<!--        <foreach collection="entities" item="entity" separator=",">-->
<!--            (#{entity.pkgId}, #{entity.itemId}, #{entity.itemName}, #{entity.itemPrice}, #{entity.username}, #{entity.mobile}, #{entity.status}, #{entity.comment}, #{entity.deleted}, #{entity.createTime}, #{entity.updateTime}, #{entity.createBy}, #{entity.updateBy})-->
<!--        </foreach>-->
<!--        on duplicate key update-->
<!--pkg_id = values(pkg_id) , item_id = values(item_id) , item_name = values(item_name) , item_price = values(item_price) , username = values(username) , mobile = values(mobile) , status = values(status) , comment = values(comment) , deleted = values(deleted) , create_time = values(create_time) , update_time = values(update_time) , create_by = values(create_by) , update_by = values(update_by)     </insert>-->

</mapper>

